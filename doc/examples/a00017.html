<HTML>
  <HEAD>
    <TITLE>asio Examples: s11n_example::server Class Reference</TITLE>
    <LINK HREF="asio.css" REL="stylesheet" TYPE="text/css">
    <LINK HREF="tabs.css" REL="stylesheet" TYPE="text/css">
  </HEAD>
  <BODY BGCOLOR="#FFFFFF">
    <DIV CLASS="qindex">
      <TABLE BORDER="0" WIDTH="100%">
        <TR>
          <TD ALIGN="LEFT">
            <B>asio 0.3.8rc1</B>
          </TD>
          <TD ALIGN="RIGHT">
            <A CLASS="qindex" HREF="../index.html">Home</A> |
            <A CLASS="qindex" HREF="../reference/index.html">Reference</A> |
            <A CLASS="qindex" HREF="../tutorial/index.html">Tutorial</A> |
            <A CLASS="qindex" HREF="../examples/index.html">Examples</A> |
            <A CLASS="qindex" HREF="../design/index.html">Design</A>
          </TD>
        </TR>
      </TABLE>
    </DIV>
    <DIV CLASS="qindex">
      <TABLE BORDER="0" WIDTH="100%">
        <TR>
          <TD ALIGN="LEFT">
            <B>Examples</B>
          </TD>
          <TD ALIGN="RIGHT">
          </TD>
        </TR>
      </TABLE>
    </DIV>
<!-- Generated by Doxygen 1.5.1 -->
<div class="nav">
<a class="el" href="a00060.html">s11n_example</a>::<a class="el" href="a00017.html">server</a></div>
<h1>s11n_example::server Class Reference</h1><!-- doxytag: class="s11n_example::server" -->Collaboration diagram for s11n_example::server:<p><center><img src="a00114.png" border="0" usemap="#a00115" alt="Collaboration graph"></center>
<map name="a00115">
<area doxygen="asio.doxytags:../reference/" href="../reference/a00014.html" shape="rect" coords="178,413,746,493" alt="">
<area doxygen="asio.doxytags:../reference/" href="../reference/a00008.html" shape="rect" coords="8,282,434,362" alt="">
<area href="a00012.html" shape="rect" coords="194,7,320,87" alt="">
<area doxygen="asio.doxytags:../reference/" href="../reference/a00008.html" shape="rect" coords="228,138,590,218" alt="">
<area doxygen="asio.doxytags:../reference/" href="../reference/a00045.html" shape="rect" coords="458,282,629,362" alt="">
</map>
<a href="a00116.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
Serves stock quote information to any client that connects to it. 
<p>

<p>
Definition at line <a class="el" href="a00080.html#l00023">23</a> of file <a class="el" href="a00080.html">server.cpp</a>.<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00017.html#48931a07de1c401cc593edee5c4fe62e">server</a> (<a class="elRef" doxygen="asio.doxytags:../reference/" href="../reference/a00032.html">asio::io_service</a> &amp;io_service, unsigned short port)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Constructor opens the acceptor and starts waiting for the first incoming connection.  <a href="#48931a07de1c401cc593edee5c4fe62e"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00017.html#1a896068b782010ec09f880163d59034">handle_accept</a> (const <a class="elRef" doxygen="asio.doxytags:../reference/" href="../reference/a00030.html">asio::error_code</a> &amp;e, <a class="el" href="a00060.html#8f27c91c3977736ad0e7f0cfff623c6a">connection_ptr</a> conn)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle completion of a accept operation.  <a href="#1a896068b782010ec09f880163d59034"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00017.html#e33b4a1b3f74f5858fd38ddb81e7f594">handle_write</a> (const <a class="elRef" doxygen="asio.doxytags:../reference/" href="../reference/a00030.html">asio::error_code</a> &amp;e, <a class="el" href="a00060.html#8f27c91c3977736ad0e7f0cfff623c6a">connection_ptr</a> conn)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle completion of a write operation.  <a href="#e33b4a1b3f74f5858fd38ddb81e7f594"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="elRef" doxygen="asio.doxytags:../reference/" href="../reference/a00014.html">asio::ip::tcp::acceptor</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00017.html#b4c503c15e9c37317202c9957c37e26b">acceptor_</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The acceptor object used to accept incoming socket connections.  <a href="#b4c503c15e9c37317202c9957c37e26b"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">std::vector&lt; <a class="el" href="a00019.html">stock</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00017.html#05f517fcb77628846fd39f3c0c158b0d">stocks_</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The data to be sent to each client.  <a href="#05f517fcb77628846fd39f3c0c158b0d"></a><br></td></tr>
</table>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="48931a07de1c401cc593edee5c4fe62e"></a><!-- doxytag: member="s11n_example::server::server" ref="48931a07de1c401cc593edee5c4fe62e" args="(asio::io_service &amp;io_service, unsigned short port)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">s11n_example::server::server           </td>
          <td>(</td>
          <td class="paramtype"><a class="elRef" doxygen="asio.doxytags:../reference/" href="../reference/a00032.html">asio::io_service</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>io_service</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned short&nbsp;</td>
          <td class="paramname"> <em>port</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Constructor opens the acceptor and starts waiting for the first incoming connection. 
<p>

<p>
Definition at line <a class="el" href="a00080.html#l00027">27</a> of file <a class="el" href="a00080.html">server.cpp</a>.<div class="fragment"><pre class="fragment"><a name="l00029"></a>00029     : <a class="code" href="a00017.html#b4c503c15e9c37317202c9957c37e26b">acceptor_</a>(io_service,
<a name="l00030"></a>00030         <a class="codeRef" doxygen="asio.doxytags:../reference/" href="../reference/a00007.html">asio::ip::tcp::endpoint</a>(<a class="codeRef" doxygen="asio.doxytags:../reference/" href="../reference/a00051.html#5123c64b44b4c5fd3c016ce75cbf096d">asio::ip::tcp::v4</a>(), port))
<a name="l00031"></a>00031   {
<a name="l00032"></a>00032     <span class="comment">// Create the data to be sent to each client.</span>
<a name="l00033"></a>00033     stock s;
<a name="l00034"></a>00034     s.code = <span class="stringliteral">"ABC"</span>;
<a name="l00035"></a>00035     s.name = <span class="stringliteral">"A Big Company"</span>;
<a name="l00036"></a>00036     s.open_price = 4.56;
<a name="l00037"></a>00037     s.high_price = 5.12;
<a name="l00038"></a>00038     s.low_price = 4.33;
<a name="l00039"></a>00039     s.last_price = 4.98;
<a name="l00040"></a>00040     s.buy_price = 4.96;
<a name="l00041"></a>00041     s.buy_quantity = 1000;
<a name="l00042"></a>00042     s.sell_price = 4.99;
<a name="l00043"></a>00043     s.sell_quantity = 2000;
<a name="l00044"></a>00044     <a class="code" href="a00017.html#05f517fcb77628846fd39f3c0c158b0d">stocks_</a>.push_back(s);
<a name="l00045"></a>00045     s.code = <span class="stringliteral">"DEF"</span>;
<a name="l00046"></a>00046     s.name = <span class="stringliteral">"Developer Entertainment Firm"</span>;
<a name="l00047"></a>00047     s.open_price = 20.24;
<a name="l00048"></a>00048     s.high_price = 22.88;
<a name="l00049"></a>00049     s.low_price = 19.50;
<a name="l00050"></a>00050     s.last_price = 19.76;
<a name="l00051"></a>00051     s.buy_price = 19.72;
<a name="l00052"></a>00052     s.buy_quantity = 34000;
<a name="l00053"></a>00053     s.sell_price = 19.85;
<a name="l00054"></a>00054     s.sell_quantity = 45000;
<a name="l00055"></a>00055     <a class="code" href="a00017.html#05f517fcb77628846fd39f3c0c158b0d">stocks_</a>.push_back(s);
<a name="l00056"></a>00056 
<a name="l00057"></a>00057     <span class="comment">// Start an accept operation for a new connection.</span>
<a name="l00058"></a>00058     <a class="code" href="a00060.html#8f27c91c3977736ad0e7f0cfff623c6a">connection_ptr</a> new_conn(<span class="keyword">new</span> connection(<a class="code" href="a00017.html#b4c503c15e9c37317202c9957c37e26b">acceptor_</a>.<a class="codeRef" doxygen="asio.doxytags:../reference/" href="../reference/a00008.html#e5208e056c92fa6130114d023a5bd8b0">io_service</a>()));
<a name="l00059"></a>00059     <a class="code" href="a00017.html#b4c503c15e9c37317202c9957c37e26b">acceptor_</a>.<a class="codeRef" doxygen="asio.doxytags:../reference/" href="../reference/a00014.html#236dafe870a90ec66e784bb216b28620">async_accept</a>(new_conn-&gt;socket(),
<a name="l00060"></a>00060         boost::bind(&amp;<a class="code" href="a00017.html#1a896068b782010ec09f880163d59034">server::handle_accept</a>, <span class="keyword">this</span>,
<a name="l00061"></a>00061           <a class="codeRef" doxygen="asio.doxytags:../reference/" href="../reference/a00130.html#441d03324a306a3f2e2c4c72485fdf4e">asio::placeholders::error</a>, new_conn));
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="1a896068b782010ec09f880163d59034"></a><!-- doxytag: member="s11n_example::server::handle_accept" ref="1a896068b782010ec09f880163d59034" args="(const asio::error_code &amp;e, connection_ptr conn)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void s11n_example::server::handle_accept           </td>
          <td>(</td>
          <td class="paramtype">const <a class="elRef" doxygen="asio.doxytags:../reference/" href="../reference/a00030.html">asio::error_code</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00060.html#8f27c91c3977736ad0e7f0cfff623c6a">connection_ptr</a>&nbsp;</td>
          <td class="paramname"> <em>conn</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handle completion of a accept operation. 
<p>

<p>
Definition at line <a class="el" href="a00080.html#l00064">64</a> of file <a class="el" href="a00080.html">server.cpp</a>.<div class="fragment"><pre class="fragment"><a name="l00066"></a>00066   {
<a name="l00067"></a>00067     <span class="keywordflow">if</span> (!e)
<a name="l00068"></a>00068     {
<a name="l00069"></a>00069       <span class="comment">// Successfully accepted a new connection. Send the list of stocks to the</span>
<a name="l00070"></a>00070       <span class="comment">// client. The connection::async_write() function will automatically</span>
<a name="l00071"></a>00071       <span class="comment">// serialize the data structure for us.</span>
<a name="l00072"></a>00072       conn-&gt;async_write(<a class="code" href="a00017.html#05f517fcb77628846fd39f3c0c158b0d">stocks_</a>,
<a name="l00073"></a>00073           boost::bind(&amp;<a class="code" href="a00017.html#e33b4a1b3f74f5858fd38ddb81e7f594">server::handle_write</a>, <span class="keyword">this</span>,
<a name="l00074"></a>00074             <a class="codeRef" doxygen="asio.doxytags:../reference/" href="../reference/a00130.html#441d03324a306a3f2e2c4c72485fdf4e">asio::placeholders::error</a>, conn));
<a name="l00075"></a>00075 
<a name="l00076"></a>00076       <span class="comment">// Start an accept operation for a new connection.</span>
<a name="l00077"></a>00077       <a class="code" href="a00060.html#8f27c91c3977736ad0e7f0cfff623c6a">connection_ptr</a> new_conn(<span class="keyword">new</span> connection(<a class="code" href="a00017.html#b4c503c15e9c37317202c9957c37e26b">acceptor_</a>.<a class="codeRef" doxygen="asio.doxytags:../reference/" href="../reference/a00008.html#e5208e056c92fa6130114d023a5bd8b0">io_service</a>()));
<a name="l00078"></a>00078       <a class="code" href="a00017.html#b4c503c15e9c37317202c9957c37e26b">acceptor_</a>.<a class="codeRef" doxygen="asio.doxytags:../reference/" href="../reference/a00014.html#236dafe870a90ec66e784bb216b28620">async_accept</a>(new_conn-&gt;socket(),
<a name="l00079"></a>00079           boost::bind(&amp;<a class="code" href="a00017.html#1a896068b782010ec09f880163d59034">server::handle_accept</a>, <span class="keyword">this</span>,
<a name="l00080"></a>00080             <a class="codeRef" doxygen="asio.doxytags:../reference/" href="../reference/a00130.html#441d03324a306a3f2e2c4c72485fdf4e">asio::placeholders::error</a>, new_conn));
<a name="l00081"></a>00081     }
<a name="l00082"></a>00082     <span class="keywordflow">else</span>
<a name="l00083"></a>00083     {
<a name="l00084"></a>00084       <span class="comment">// An error occurred. Log it and return. Since we are not starting a new</span>
<a name="l00085"></a>00085       <span class="comment">// accept operation the io_service will run out of work to do and the</span>
<a name="l00086"></a>00086       <span class="comment">// server will exit.</span>
<a name="l00087"></a>00087       std::cerr &lt;&lt; e &lt;&lt; std::endl;
<a name="l00088"></a>00088     }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="e33b4a1b3f74f5858fd38ddb81e7f594"></a><!-- doxytag: member="s11n_example::server::handle_write" ref="e33b4a1b3f74f5858fd38ddb81e7f594" args="(const asio::error_code &amp;e, connection_ptr conn)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void s11n_example::server::handle_write           </td>
          <td>(</td>
          <td class="paramtype">const <a class="elRef" doxygen="asio.doxytags:../reference/" href="../reference/a00030.html">asio::error_code</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00060.html#8f27c91c3977736ad0e7f0cfff623c6a">connection_ptr</a>&nbsp;</td>
          <td class="paramname"> <em>conn</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handle completion of a write operation. 
<p>

<p>
Definition at line <a class="el" href="a00080.html#l00091">91</a> of file <a class="el" href="a00080.html">server.cpp</a>.<div class="fragment"><pre class="fragment"><a name="l00093"></a>00093   {
<a name="l00094"></a>00094     <span class="comment">// Nothing to do. The socket will be closed automatically when the last</span>
<a name="l00095"></a>00095     <span class="comment">// reference to the connection object goes away.</span>
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="b4c503c15e9c37317202c9957c37e26b"></a><!-- doxytag: member="s11n_example::server::acceptor_" ref="b4c503c15e9c37317202c9957c37e26b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="elRef" doxygen="asio.doxytags:../reference/" href="../reference/a00014.html">asio::ip::tcp::acceptor</a> <a class="el" href="a00017.html#b4c503c15e9c37317202c9957c37e26b">s11n_example::server::acceptor_</a><code> [private]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
The acceptor object used to accept incoming socket connections. 
<p>

<p>
Definition at line <a class="el" href="a00080.html#l00099">99</a> of file <a class="el" href="a00080.html">server.cpp</a>.
</div>
</div><p>
<a class="anchor" name="05f517fcb77628846fd39f3c0c158b0d"></a><!-- doxytag: member="s11n_example::server::stocks_" ref="05f517fcb77628846fd39f3c0c158b0d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="a00019.html">stock</a>&gt; <a class="el" href="a00017.html#05f517fcb77628846fd39f3c0c158b0d">s11n_example::server::stocks_</a><code> [private]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
The data to be sent to each client. 
<p>

<p>
Definition at line <a class="el" href="a00080.html#l00102">102</a> of file <a class="el" href="a00080.html">server.cpp</a>.
</div>
</div><p>
<hr>The documentation for this class was generated from the following file:<ul>
<li>serialization/<a class="el" href="a00080.html">server.cpp</a></ul>
    <DIV CLASS="qindex">
      <TABLE BORDER="0" WIDTH="100%">
        <TR>
          <TD ALIGN="LEFT">
            <B>asio 0.3.8rc1</B>
          </TD>
          <TD ALIGN="RIGHT">
            <A CLASS="qindex" HREF="../index.html">Home</A> |
            <A CLASS="qindex" HREF="../reference/index.html">Reference</A> |
            <A CLASS="qindex" HREF="../tutorial/index.html">Tutorial</A> |
            <A CLASS="qindex" HREF="../examples/index.html">Examples</A> |
            <A CLASS="qindex" HREF="../design/index.html">Design</A>
          </TD>
        </TR>
      </TABLE>
    </DIV>
  </BODY>
</HTML>
