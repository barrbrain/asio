<HTML>
  <HEAD>
    <TITLE>asio Examples: s11n_example::server Class Reference</TITLE>
    <LINK HREF="asio.css" REL="stylesheet" TYPE="text/css">
    <LINK HREF="tabs.css" REL="stylesheet" TYPE="text/css">
  </HEAD>
  <BODY BGCOLOR="#FFFFFF">
    <DIV CLASS="qindex">
      <TABLE BORDER="0" WIDTH="100%">
        <TR>
          <TD ALIGN="LEFT">
            <B>asio 0.3.7</B>
          </TD>
          <TD ALIGN="RIGHT">
            <A CLASS="qindex" HREF="../index.html">Home</A> |
            <A CLASS="qindex" HREF="../reference/index.html">Reference</A> |
            <A CLASS="qindex" HREF="../tutorial/index.html">Tutorial</A> |
            <A CLASS="qindex" HREF="../examples/index.html">Examples</A> |
            <A CLASS="qindex" HREF="../design/index.html">Design</A>
          </TD>
        </TR>
      </TABLE>
    </DIV>
    <DIV CLASS="qindex">
      <TABLE BORDER="0" WIDTH="100%">
        <TR>
          <TD ALIGN="LEFT">
            <B>Examples</B>
          </TD>
          <TD ALIGN="RIGHT">
          </TD>
        </TR>
      </TABLE>
    </DIV>
<!-- Generated by Doxygen 1.4.7 -->
<div class="nav">
<a class="el" href="a00263.html">s11n_example</a>::<a class="el" href="a00223.html">server</a></div>
<h1>s11n_example::server Class Reference</h1><!-- doxytag: class="s11n_example::server" -->Collaboration diagram for s11n_example::server:<p><center><img src="a00335.png" border="0" usemap="#a00336" alt="Collaboration graph"></center>
<map name="a00336">
<area doxygen="asio.doxytags:../reference/" href="../reference/a00114.html" shape="rect" coords="129,269,564,349" alt="">
<area doxygen="asio.doxytags:../reference/" href="../reference/a00108.html" shape="rect" coords="8,138,301,218" alt="">
<area href="a00209.html" shape="rect" coords="92,7,217,87" alt="">
<area doxygen="asio.doxytags:../reference/" href="../reference/a00157.html" shape="rect" coords="325,138,496,218" alt="">
</map>
<a href="a00086.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
Serves stock quote information to any client that connects to it. 
<p>

<p>
Definition at line <a class="el" href="a00291.html#l00013">13</a> of file <a class="el" href="a00291.html">server.cpp</a>.<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00223.html#48931a07de1c401cc593edee5c4fe62e">server</a> (<a class="elRef" doxygen="asio.doxytags:../reference/" href="../reference/a00140.html">asio::io_service</a> &amp;io_service, unsigned short port)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Constructor opens the acceptor and starts waiting for the first incoming connection.  <a href="#48931a07de1c401cc593edee5c4fe62e"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00223.html#c79464ab6491d12f638dc61f034f03e0">handle_accept</a> (const <a class="elRef" doxygen="asio.doxytags:../reference/" href="../reference/a00135.html">asio::error</a> &amp;e, <a class="el" href="a00263.html#8f27c91c3977736ad0e7f0cfff623c6a">connection_ptr</a> conn)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle completion of a accept operation.  <a href="#c79464ab6491d12f638dc61f034f03e0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00223.html#7f24981d39db19b83537b0dfd192f113">handle_write</a> (const <a class="elRef" doxygen="asio.doxytags:../reference/" href="../reference/a00135.html">asio::error</a> &amp;e, <a class="el" href="a00263.html#8f27c91c3977736ad0e7f0cfff623c6a">connection_ptr</a> conn)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle completion of a write operation.  <a href="#7f24981d39db19b83537b0dfd192f113"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="elRef" doxygen="asio.doxytags:../reference/" href="../reference/a00114.html">asio::ip::tcp::acceptor</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00223.html#b4c503c15e9c37317202c9957c37e26b">acceptor_</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The acceptor object used to accept incoming socket connections.  <a href="#b4c503c15e9c37317202c9957c37e26b"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">std::vector&lt; <a class="el" href="a00224.html">stock</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00223.html#05f517fcb77628846fd39f3c0c158b0d">stocks_</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The data to be sent to each client.  <a href="#05f517fcb77628846fd39f3c0c158b0d"></a><br></td></tr>
</table>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="48931a07de1c401cc593edee5c4fe62e"></a><!-- doxytag: member="s11n_example::server::server" ref="48931a07de1c401cc593edee5c4fe62e" args="(asio::io_service &amp;io_service, unsigned short port)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">s11n_example::server::server           </td>
          <td>(</td>
          <td class="paramtype"><a class="elRef" doxygen="asio.doxytags:../reference/" href="../reference/a00140.html">asio::io_service</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>io_service</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned short&nbsp;</td>
          <td class="paramname"> <em>port</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Constructor opens the acceptor and starts waiting for the first incoming connection. 
<p>

<p>
Definition at line <a class="el" href="a00291.html#l00017">17</a> of file <a class="el" href="a00291.html">server.cpp</a>.<div class="fragment"><pre class="fragment"><a name="l00019"></a>00019     : <a class="code" href="a00223.html#b4c503c15e9c37317202c9957c37e26b">acceptor_</a>(io_service,
<a name="l00020"></a>00020         <a class="codeRef" doxygen="asio.doxytags:../reference/" href="../reference/a00107.html">asio::ip::tcp::endpoint</a>(<a class="codeRef" doxygen="asio.doxytags:../reference/" href="../reference/a00168.html#5123c64b44b4c5fd3c016ce75cbf096d">asio::ip::tcp::v4</a>(), port))
<a name="l00021"></a>00021   {
<a name="l00022"></a>00022     <span class="comment">// Create the data to be sent to each client.</span>
<a name="l00023"></a>00023     stock s;
<a name="l00024"></a>00024     s.code = <span class="stringliteral">"ABC"</span>;
<a name="l00025"></a>00025     s.name = <span class="stringliteral">"A Big Company"</span>;
<a name="l00026"></a>00026     s.open_price = 4.56;
<a name="l00027"></a>00027     s.high_price = 5.12;
<a name="l00028"></a>00028     s.low_price = 4.33;
<a name="l00029"></a>00029     s.last_price = 4.98;
<a name="l00030"></a>00030     s.buy_price = 4.96;
<a name="l00031"></a>00031     s.buy_quantity = 1000;
<a name="l00032"></a>00032     s.sell_price = 4.99;
<a name="l00033"></a>00033     s.sell_quantity = 2000;
<a name="l00034"></a>00034     <a class="code" href="a00223.html#05f517fcb77628846fd39f3c0c158b0d">stocks_</a>.push_back(s);
<a name="l00035"></a>00035     s.code = <span class="stringliteral">"DEF"</span>;
<a name="l00036"></a>00036     s.name = <span class="stringliteral">"Developer Entertainment Firm"</span>;
<a name="l00037"></a>00037     s.open_price = 20.24;
<a name="l00038"></a>00038     s.high_price = 22.88;
<a name="l00039"></a>00039     s.low_price = 19.50;
<a name="l00040"></a>00040     s.last_price = 19.76;
<a name="l00041"></a>00041     s.buy_price = 19.72;
<a name="l00042"></a>00042     s.buy_quantity = 34000;
<a name="l00043"></a>00043     s.sell_price = 19.85;
<a name="l00044"></a>00044     s.sell_quantity = 45000;
<a name="l00045"></a>00045     <a class="code" href="a00223.html#05f517fcb77628846fd39f3c0c158b0d">stocks_</a>.push_back(s);
<a name="l00046"></a>00046 
<a name="l00047"></a>00047     <span class="comment">// Start an accept operation for a new connection.</span>
<a name="l00048"></a>00048     <a class="code" href="a00263.html#8f27c91c3977736ad0e7f0cfff623c6a">connection_ptr</a> new_conn(<span class="keyword">new</span> connection(<a class="code" href="a00223.html#b4c503c15e9c37317202c9957c37e26b">acceptor_</a>.<a class="codeRef" doxygen="asio.doxytags:../reference/" href="../reference/a00108.html#07646b3fbab85fb0e438a8a651461881">io_service</a>()));
<a name="l00049"></a>00049     <a class="code" href="a00223.html#b4c503c15e9c37317202c9957c37e26b">acceptor_</a>.<a class="codeRef" doxygen="asio.doxytags:../reference/" href="../reference/a00114.html#22a157dd69213f68d119e6a9990cb407">async_accept</a>(new_conn-&gt;socket(),
<a name="l00050"></a>00050         boost::bind(&amp;<a class="code" href="a00223.html#c79464ab6491d12f638dc61f034f03e0">server::handle_accept</a>, <span class="keyword">this</span>,
<a name="l00051"></a>00051           <a class="codeRef" doxygen="asio.doxytags:../reference/" href="../reference/a00266.html#b652117cf6b85d856a2cada43e562b3a">asio::placeholders::error</a>, new_conn));
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="c79464ab6491d12f638dc61f034f03e0"></a><!-- doxytag: member="s11n_example::server::handle_accept" ref="c79464ab6491d12f638dc61f034f03e0" args="(const asio::error &amp;e, connection_ptr conn)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void s11n_example::server::handle_accept           </td>
          <td>(</td>
          <td class="paramtype">const <a class="elRef" doxygen="asio.doxytags:../reference/" href="../reference/a00135.html">asio::error</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00263.html#8f27c91c3977736ad0e7f0cfff623c6a">connection_ptr</a>&nbsp;</td>
          <td class="paramname"> <em>conn</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handle completion of a accept operation. 
<p>

<p>
Definition at line <a class="el" href="a00291.html#l00054">54</a> of file <a class="el" href="a00291.html">server.cpp</a>.<div class="fragment"><pre class="fragment"><a name="l00056"></a>00056   {
<a name="l00057"></a>00057     <span class="keywordflow">if</span> (!e)
<a name="l00058"></a>00058     {
<a name="l00059"></a>00059       <span class="comment">// Successfully accepted a new connection. Send the list of stocks to the</span>
<a name="l00060"></a>00060       <span class="comment">// client. The connection::async_write() function will automatically</span>
<a name="l00061"></a>00061       <span class="comment">// serialize the data structure for us.</span>
<a name="l00062"></a>00062       conn-&gt;async_write(<a class="code" href="a00223.html#05f517fcb77628846fd39f3c0c158b0d">stocks_</a>,
<a name="l00063"></a>00063           boost::bind(&amp;<a class="code" href="a00223.html#7f24981d39db19b83537b0dfd192f113">server::handle_write</a>, <span class="keyword">this</span>,
<a name="l00064"></a>00064             <a class="codeRef" doxygen="asio.doxytags:../reference/" href="../reference/a00266.html#b652117cf6b85d856a2cada43e562b3a">asio::placeholders::error</a>, conn));
<a name="l00065"></a>00065 
<a name="l00066"></a>00066       <span class="comment">// Start an accept operation for a new connection.</span>
<a name="l00067"></a>00067       <a class="code" href="a00263.html#8f27c91c3977736ad0e7f0cfff623c6a">connection_ptr</a> new_conn(<span class="keyword">new</span> connection(<a class="code" href="a00223.html#b4c503c15e9c37317202c9957c37e26b">acceptor_</a>.<a class="codeRef" doxygen="asio.doxytags:../reference/" href="../reference/a00108.html#07646b3fbab85fb0e438a8a651461881">io_service</a>()));
<a name="l00068"></a>00068       <a class="code" href="a00223.html#b4c503c15e9c37317202c9957c37e26b">acceptor_</a>.<a class="codeRef" doxygen="asio.doxytags:../reference/" href="../reference/a00114.html#22a157dd69213f68d119e6a9990cb407">async_accept</a>(new_conn-&gt;socket(),
<a name="l00069"></a>00069           boost::bind(&amp;<a class="code" href="a00223.html#c79464ab6491d12f638dc61f034f03e0">server::handle_accept</a>, <span class="keyword">this</span>,
<a name="l00070"></a>00070             <a class="codeRef" doxygen="asio.doxytags:../reference/" href="../reference/a00266.html#b652117cf6b85d856a2cada43e562b3a">asio::placeholders::error</a>, new_conn));
<a name="l00071"></a>00071     }
<a name="l00072"></a>00072     <span class="keywordflow">else</span>
<a name="l00073"></a>00073     {
<a name="l00074"></a>00074       <span class="comment">// An error occurred. Log it and return. Since we are not starting a new</span>
<a name="l00075"></a>00075       <span class="comment">// accept operation the io_service will run out of work to do and the</span>
<a name="l00076"></a>00076       <span class="comment">// server will exit.</span>
<a name="l00077"></a>00077       std::cerr &lt;&lt; e &lt;&lt; std::endl;
<a name="l00078"></a>00078     }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="7f24981d39db19b83537b0dfd192f113"></a><!-- doxytag: member="s11n_example::server::handle_write" ref="7f24981d39db19b83537b0dfd192f113" args="(const asio::error &amp;e, connection_ptr conn)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void s11n_example::server::handle_write           </td>
          <td>(</td>
          <td class="paramtype">const <a class="elRef" doxygen="asio.doxytags:../reference/" href="../reference/a00135.html">asio::error</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00263.html#8f27c91c3977736ad0e7f0cfff623c6a">connection_ptr</a>&nbsp;</td>
          <td class="paramname"> <em>conn</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handle completion of a write operation. 
<p>

<p>
Definition at line <a class="el" href="a00291.html#l00081">81</a> of file <a class="el" href="a00291.html">server.cpp</a>.<div class="fragment"><pre class="fragment"><a name="l00083"></a>00083   {
<a name="l00084"></a>00084     <span class="comment">// Nothing to do. The socket will be closed automatically when the last</span>
<a name="l00085"></a>00085     <span class="comment">// reference to the connection object goes away.</span>
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="b4c503c15e9c37317202c9957c37e26b"></a><!-- doxytag: member="s11n_example::server::acceptor_" ref="b4c503c15e9c37317202c9957c37e26b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="elRef" doxygen="asio.doxytags:../reference/" href="../reference/a00114.html">asio::ip::tcp::acceptor</a> <a class="el" href="a00223.html#b4c503c15e9c37317202c9957c37e26b">s11n_example::server::acceptor_</a><code> [private]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
The acceptor object used to accept incoming socket connections. 
<p>

<p>
Definition at line <a class="el" href="a00291.html#l00089">89</a> of file <a class="el" href="a00291.html">server.cpp</a>.
</div>
</div><p>
<a class="anchor" name="05f517fcb77628846fd39f3c0c158b0d"></a><!-- doxytag: member="s11n_example::server::stocks_" ref="05f517fcb77628846fd39f3c0c158b0d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="a00224.html">stock</a>&gt; <a class="el" href="a00223.html#05f517fcb77628846fd39f3c0c158b0d">s11n_example::server::stocks_</a><code> [private]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
The data to be sent to each client. 
<p>

<p>
Definition at line <a class="el" href="a00291.html#l00092">92</a> of file <a class="el" href="a00291.html">server.cpp</a>.
</div>
</div><p>
<hr>The documentation for this class was generated from the following file:<ul>
<li>serialization/<a class="el" href="a00291.html">server.cpp</a></ul>
    <DIV CLASS="qindex">
      <TABLE BORDER="0" WIDTH="100%">
        <TR>
          <TD ALIGN="LEFT">
            <B>asio 0.3.7</B>
          </TD>
          <TD ALIGN="RIGHT">
            <A CLASS="qindex" HREF="../index.html">Home</A> |
            <A CLASS="qindex" HREF="../reference/index.html">Reference</A> |
            <A CLASS="qindex" HREF="../tutorial/index.html">Tutorial</A> |
            <A CLASS="qindex" HREF="../examples/index.html">Examples</A> |
            <A CLASS="qindex" HREF="../design/index.html">Design</A>
          </TD>
        </TR>
      </TABLE>
    </DIV>
  </BODY>
</HTML>
