<HTML>
  <HEAD>
    <TITLE>asio Examples: chat/chat_message.hpp</TITLE>
    <LINK HREF="asio.css" REL="stylesheet" TYPE="text/css">
    <LINK HREF="tabs.css" REL="stylesheet" TYPE="text/css">
  </HEAD>
  <BODY BGCOLOR="#FFFFFF">
    <DIV CLASS="qindex">
      <TABLE BORDER="0" WIDTH="100%">
        <TR>
          <TD ALIGN="LEFT">
            <B>asio 0.3.8rc2</B>
          </TD>
          <TD ALIGN="RIGHT">
            <A CLASS="qindex" HREF="../index.html">Home</A> |
            <A CLASS="qindex" HREF="../reference/index.html">Reference</A> |
            <A CLASS="qindex" HREF="../tutorial/index.html">Tutorial</A> |
            <A CLASS="qindex" HREF="../examples/index.html">Examples</A> |
            <A CLASS="qindex" HREF="../design/index.html">Design</A>
          </TD>
        </TR>
      </TABLE>
    </DIV>
    <DIV CLASS="qindex">
      <TABLE BORDER="0" WIDTH="100%">
        <TR>
          <TD ALIGN="LEFT">
            <B>Examples</B>
          </TD>
          <TD ALIGN="RIGHT">
          </TD>
        </TR>
      </TABLE>
    </DIV>
<!-- Generated by Doxygen 1.5.1 -->
<h1><a class="anchor" name="chat_chat_message_hpp">chat/chat_message.hpp</a></h1><div class="fragment"><pre class="fragment"><span class="comment">//</span>
<span class="comment">// chat_message.hpp</span>
<span class="comment">// ~~~~~~~~~~~~~~~~</span>
<span class="comment">//</span>
<span class="comment">// Copyright (c) 2003-2007 Christopher M. Kohlhoff (chris at kohlhoff dot com)</span>
<span class="comment">//</span>
<span class="comment">// Distributed under the Boost Software License, Version 1.0. (See accompanying</span>
<span class="comment">// file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)</span>
<span class="comment">//</span>

<span class="preprocessor">#ifndef CHAT_MESSAGE_HPP</span>
<span class="preprocessor"></span><span class="preprocessor">#define CHAT_MESSAGE_HPP</span>
<span class="preprocessor"></span>
<span class="preprocessor">#include &lt;cstdio&gt;</span>
<span class="preprocessor">#include &lt;cstdlib&gt;</span>
<span class="preprocessor">#include &lt;cstring&gt;</span>

<span class="keyword">class </span>chat_message
{
<span class="keyword">public</span>:
  <span class="keyword">enum</span> { header_length = 4 };
  <span class="keyword">enum</span> { max_body_length = 512 };

  chat_message()
    : body_length_(0)
  {
  }

  <span class="keyword">const</span> <span class="keywordtype">char</span>* data()<span class="keyword"> const</span>
<span class="keyword">  </span>{
    <span class="keywordflow">return</span> data_;
  }

  <span class="keywordtype">char</span>* data()
  {
    <span class="keywordflow">return</span> data_;
  }

  size_t length()<span class="keyword"> const</span>
<span class="keyword">  </span>{
    <span class="keywordflow">return</span> header_length + body_length_;
  }

  <span class="keyword">const</span> <span class="keywordtype">char</span>* body()<span class="keyword"> const</span>
<span class="keyword">  </span>{
    <span class="keywordflow">return</span> data_ + header_length;
  }

  <span class="keywordtype">char</span>* body()
  {
    <span class="keywordflow">return</span> data_ + header_length;
  }

  size_t body_length()<span class="keyword"> const</span>
<span class="keyword">  </span>{
    <span class="keywordflow">return</span> body_length_;
  }

  <span class="keywordtype">void</span> body_length(size_t length)
  {
    body_length_ = length;
    <span class="keywordflow">if</span> (body_length_ &gt; max_body_length)
      body_length_ = max_body_length;
  }

  <span class="keywordtype">bool</span> decode_header()
  {
    <span class="keyword">using namespace </span>std; <span class="comment">// For strncat and atoi.</span>
    <span class="keywordtype">char</span> header[header_length + 1] = <span class="stringliteral">""</span>;
    strncat(header, data_, header_length);
    body_length_ = atoi(header);
    <span class="keywordflow">if</span> (body_length_ &gt; max_body_length)
    {
      body_length_ = 0;
      <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
  }

  <span class="keywordtype">void</span> encode_header()
  {
    <span class="keyword">using namespace </span>std; <span class="comment">// For sprintf and memcpy.</span>
    <span class="keywordtype">char</span> header[header_length + 1] = <span class="stringliteral">""</span>;
    sprintf(header, <span class="stringliteral">"%4d"</span>, body_length_);
    memcpy(data_, header, header_length);
  }

<span class="keyword">private</span>:
  <span class="keywordtype">char</span> data_[header_length + max_body_length];
  size_t body_length_;
};

<span class="preprocessor">#endif // CHAT_MESSAGE_HPP</span>
</pre></div>     <DIV CLASS="qindex">
      <TABLE BORDER="0" WIDTH="100%">
        <TR>
          <TD ALIGN="LEFT">
            <B>asio 0.3.8rc2</B>
          </TD>
          <TD ALIGN="RIGHT">
            <A CLASS="qindex" HREF="../index.html">Home</A> |
            <A CLASS="qindex" HREF="../reference/index.html">Reference</A> |
            <A CLASS="qindex" HREF="../tutorial/index.html">Tutorial</A> |
            <A CLASS="qindex" HREF="../examples/index.html">Examples</A> |
            <A CLASS="qindex" HREF="../design/index.html">Design</A>
          </TD>
        </TR>
      </TABLE>
    </DIV>
  </BODY>
</HTML>
